<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reset Password</title>
  </head>
  <body>
    <h2>Reset Password</h2>
    <input
      type="password"
      id="new-password"
      placeholder="Enter new password"
    />
    <button id="update-button">Update Password</button>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <script>
      // 1. Initialize Supabase Client
      // âœ… Variables are now correctly defined before being used.
      const supabaseUrl = "https://kirhitjejcjimdfzotse.supabase.co";
      const supabaseKey =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtpcmhpdGplamNqaW1kZnpvdHNlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1NjUxNDQsImV4cCI6MjA3MTE0MTE0NH0.Xfk9wFjIjbav-ZYN58yH05Aelxk9yHTuEICMBUOtD3E";
      const supabase = supabase.createClient(supabaseUrl, supabaseKey);

      // 2. Handle Password Reset Logic
      // This listener checks if the user arrived from a password reset link.
      supabase.auth.onAuthStateChange(async (event, session) => {
        // The 'PASSWORD_RECOVERY' event fires when the user lands on this page
        // after clicking the reset link in their email.
        if (event === "PASSWORD_RECOVERY") {
          const updateButton = document.getElementById("update-button");

          updateButton.onclick = async function () {
            const newPassword = document.getElementById("new-password").value;

            // Check if the password field is empty
            if (!newPassword) {
              alert("Please enter a new password.");
              return;
            }

            // Update the user's password
            const { data, error } = await supabase.auth.updateUser({
              password: newPassword,
            });

            if (error) {
              alert("Error: " + error.message);
            } else {
              alert("Password updated successfully!");
            }
          };
        }
      });
    </script>
  </body>
</html>
